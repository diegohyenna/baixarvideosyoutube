<!DOCTYPE html>
<html>
<head>
	<title>Baixar video do youtube</title>
</head>
<body>

	<div id="download">
		<h3>Download - Informe o url do video do Youtube</h3>

		<div>
			<a href="/videos">Ver videos já baixados</a>
		</div>

		<input id="text" type="text" name="">

		<button id="button" onclick="enviar()">Download</button>
	</div>

	<script>
		function enviar(){

			var base = document.getElementById('download');
			var texto = document.getElementById('text');
			var button = document.getElementById('button');	

			if(texto.value == '')
			{
				alert("Não pode fazer download da url em branco!")
				return
			}

			texto.style.display = 'none';
			button.style.display = 'none';

			var img = document.createElement('img');
			img.setAttribute('src', 'https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif');
			base.appendChild(img);  

			fetch("/download", {
				method: 'POST',
				headers: {'Content-Type': 'Application/json'},
				body: JSON.stringify({url: texto.value})
			})
			.then(function(response){ return response.json()})
			.then(function(response){
				img.style.display = 'none';
				texto.style.display = 'inline';
				button.style.display = 'inline';
				alert('Baixou finalmente!');
				window.location = "/"+response.video
			});		
		}

	</script>
</body>
</html>